{% extends 'base/base.html' %}
{% block content %}

<div class="container" style="align-content: center">

	<div class="card text-left">

		<div class="card-header">
			<ul class="nav nav-pills card-header-pills">
				<li class="nav-item">
					<a class="nav-link disabled" href="#">What happened?</a>
				</li>
				<li class="nav-item">
					<a class="nav-link active" href="#">Details?</a>
				</li>
				<li class="nav-item">
					<a class="nav-link disabled" href="#">Where?</a>
				</li>
				<li class="nav-item">
					<a class="nav-link disabled" href="#">Photos?</a>
				</li>
				<li class="nav-item">
					<a class="nav-link disabled" href="#">Submit</a>
				</li>
			</ul>
		</div>

		<div class="card-body">
			<h2 class="card-title text-center mt-2 mb-5">That sucks. Give us the details.</h2>

			<form>
				<div class="form-group">
					<label for="company-name">Company</label>
					<select id="company-name" class="custom-select">
						<option value="1">Bad Courier PLC</option>
						<option value="2">Bad Trucking Company</option>
						<option value="3">Not listed</option>
					</select>
				</div>
				<div class="form-group">
					<label for="registration-number">Registration number</label>
					<input type="text" class="form-control" id="registration-number" placeholder="B4D PRK1NG" required>
				</div>
				<div class="row">
					<div class="col-sm-6">
						<div class="form-group">
							<label for="vehicle-colour">Vehicle colour</label>
							<input type="text" class="form-control" id="vehicle-colour" placeholder="White" required>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="form-group">
							<label for="vehicle-brand">Vehicle brand and model</label>
							<input type="text" class="form-control" id="vehicle-brand" placeholder="Ford Transit" required>
						</div>
					</div>
				</div>

				<div class="form-group">
					<label for="details-body">Any details to add?</label>
					<textarea id="details-body" class="form-control" rows="3" placeholder="Tell us what happened. Just the facts." required></textarea>
				</div>

				<div class="text-right">
					<button type="submit" class="btn btn-primary mt-3">Next</button>
				</div>
			</form>

		</div>
	</div>

	<script>

        let latitude;
        let longitude;

        let postcode;
        let street_name;
        let council_name;
        let city_name;

        function getLocation() {
            $("#find-me").html('<i class=\"fas fa-spinner fa-pulse\"></i> Looking...');

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(storePosition);
            } else {
                window.alert ("Geolocation is not supported by this browser.");
            }
        }

        function storePosition(position) {
            latitude = position.coords.latitude;
            longitude = position.coords.longitude;
            parsePosition()
        }

        function getData() {
            let lookup_endpoint = "https://api.postcodes.io/postcodes?lon=" + longitude + "&lat=" + latitude

            $.getJSON(lookup_endpoint, function( json ) {
                postcode = json.result[ 1 ].postcode;
                council_name = json.result[ 1 ].admin_district;
                city_name = json.result [ 1 ].region;

                document.getElementById("postcode").value = postcode;
                document.getElementById("council-name").value = council_name;
                document.getElementById("city-name").value = city_name;

                $("#find-me").html('<i class=\"fas fa-check-circle\"></i> Found...');
                $("#found-notice").html("... but you need to put in your own streetname")

                $("#road-name").addClass("is-invalid");
                $("#road-name-feedback").html("Really weirdly, in the UK street names are not publicly available for free by postcode, so you need to type this manually - <a href=''>learn more</a>")


            });

            return false;
        }

        function parsePosition() {
            getData()
        }

	</script>

{% endblock %}
